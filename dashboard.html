<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - WIT</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="dashboard.css" />
  </head>
  <body class="dashboard-page">
    <div class="wrapper">
      <!-- Sidebar -->
      <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="brand-logo-sidebar">
                <div class="logo-container-sidebar">
                    <img src="wit.png" alt="WIT Logo">
                </div>
            </div>
            <div class="user-info">
                <i class="bi bi-person-circle"></i>
                <div>
                    <div class="user-email" id="userEmail">admin@wit.la</div>
                    <div class="user-role" id="userRole">Administrador</div>
                </div>
            </div>
        </div>

        <ul class="list-unstyled components">
          <li class="active">
            <a href="dashboard.html"><i class="bi bi-grid"></i> Dashboard</a>
          </li>
          <li>
            <a href="./banos/banos.html"><i class="bi bi-droplet"></i> Baños</a>
          </li>
          <li>
            <a href="./custodia/custodia.html"
              ><i class="bi bi-shield-check"></i> Custodia</a
            >
          </li>
          <li>
            <a href="./parking/parking.html"><i class="bi bi-car-front"></i> Parking</a>
          </li>
          <li>
            <a href="andenes.html"><i class="bi bi-signpost"></i> Andenes</a>
          </li>
          <li>
            <a href="./caja/caja.html"><i class="bi bi-cash-coin"></i> Caja</a>
          </li>
          <li>
            <a href="404.html"><i class="bi bi-display"></i> Monitoreo</a>
          </li>
          <li class="menu-section">CONFIGURACIÓN</li>
          <li>
            <a href="empresas.html"><i class="bi bi-building"></i> Empresas</a>
          </li>
          <li>
            <a href="destinos.html"><i class="bi bi-geo-alt"></i> Destinos</a>
          </li>
          <li>
            <a href="usuarios.html"><i class="bi bi-people"></i> Usuarios</a>
          </li>
          <li>
            <a href="listas-blancas.html"
              ><i class="bi bi-list-check"></i> Listas Blancas</a
            >
          </li>
          <li>
            <a href="404.html"
              ><i class="bi bi-currency-dollar"></i> Pagos Diarios</a
            >
          </li>
          <li>
            <a href="entradas-salidas.html"
              ><i class="bi bi-arrow-left-right"></i> Entradas y Salidas</a
            >
          </li>
          <li>
            <a href="#" id="logoutBtn"
              ><i class="bi bi-box-arrow-right"></i> Cerrar Sesión</a
            >
          </li>
        </ul>
      </nav>

      <!-- Page Content -->
      <div id="content">
        <div class="top-bar">
          <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="bi bi-list"></i>
          </button>
          <h4>Sistema de Control de Terminales Terrestres</h4>
          <div class="top-bar-actions">
            <div class="search-box">
              <i class="bi bi-search"></i>
              <input type="text" placeholder="Buscar..." />
            </div>
          </div>
        </div>

        <div class="container-fluid">
          <div class="page-header">
            <div>
              <h2>Dashboard</h2>
              <p class="text">
                Bienvenido al sistema de control de terminales terrestres
              </p>
            </div>
            <div class="date-display" id="currentDate"></div>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions mb-4">
            <h5>Acciones Rápidas</h5>
            <div class="action-buttons">
              <a href="parking.html" class="action-btn">
                <i class="bi bi-car-front"></i>
                <span>Gestión Parking</span>
              </a>
              <a href="caja.html" class="action-btn">
                <i class="bi bi-cash-coin"></i>
                <span>Registrar Pago</span>
              </a>
              <a href="usuarios.html" class="action-btn">
                <i class="bi bi-person-plus"></i>
                <span>Nuevo Usuario</span>
              </a>
              <a href="empresas.html" class="action-btn">
                <i class="bi bi-building"></i>
                <span>Agregar Empresa</span>
              </a>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="stats-row">
            <div class="stat-card">
              <div class="stat-icon bg-primary">
                <i class="bi bi-people"></i>
              </div>
              <div class="stat-details">
                <h3 id="activeUsers">6</h3>
                <p>Usuarios Activos</p>
                <div class="stat-trend trend-up">
                  <i class="bi bi-arrow-up"></i>
                  <span>+2 desde ayer</span>
                </div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon bg-success">
                <i class="bi bi-building"></i>
              </div>
              <div class="stat-details">
                <h3 id="registeredCompanies">5</h3>
                <p>Empresas Registradas</p>
                <div class="stat-trend">
                  <span>Sin cambios</span>
                </div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon bg-warning">
                <i class="bi bi-currency-dollar"></i>
              </div>
              <div class="stat-details">
                <h3 id="todayIncome">$125,430</h3>
                <p>Ingresos Hoy</p>
                <div class="stat-trend trend-up">
                  <i class="bi bi-arrow-up"></i>
                  <span>+12% vs ayer</span>
                </div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon bg-info">
                <i class="bi bi-car-front"></i>
              </div>
              <div class="stat-details">
                <h3 id="parkingVehicles">24</h3>
                <p>Vehículos en Parking</p>
                <div class="stat-trend trend-down">
                  <i class="bi bi-arrow-down"></i>
                  <span>-3 desde ayer</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Main Content Grid -->
          <div class="content-grid">
            <!-- Activity Card -->
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Actividad Reciente</h5>
                <div class="card-actions">
                  <button class="card-action-btn" title="Refrescar">
                    <i class="bi bi-arrow-clockwise"></i>
                  </button>
                  <button class="card-action-btn" title="Filtrar">
                    <i class="bi bi-funnel"></i>
                  </button>
                </div>
              </div>
              <div class="card-body">
                <div class="activity-list" id="activityList">
                  <!-- Activity items aquí -->
                </div>
              </div>
            </div>

            <!-- Performance Card -->
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Rendimiento del Sistema</h5>
                <div class="card-actions">
                  <button class="card-action-btn" title="Ver detalles">
                    <i class="bi bi-three-dots"></i>
                  </button>
                </div>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <!-- Gráfico aquí -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="session.js"></script>
    <script>
      // Función para formatear y mostrar la fecha actual
      function updateCurrentDate() {
        const now = new Date();
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        const formattedDate = now.toLocaleDateString("es-ES", options);
        document.getElementById("currentDate").textContent = formattedDate;
      }

      // Función para simular datos en tiempo real
      function simulateRealTimeUpdates() {
        // Simular cambios en las estadísticas
        setInterval(() => {
          const users = document.getElementById("activeUsers");
          const currentUsers = parseInt(users.textContent);
          const randomChange = Math.random() > 0.7 ? 1 : 0;
          users.textContent = currentUsers + randomChange;
        }, 10000);
      }

      // Toggle del menú móvil
      document
        .getElementById("mobileMenuToggle")
        .addEventListener("click", function () {
          document.getElementById("sidebar").classList.toggle("active");
        });

      // Cerrar menú móvil al hacer clic en un enlace
      document.querySelectorAll(".components li a").forEach((link) => {
        link.addEventListener("click", function () {
          if (window.innerWidth <= 768) {
            document.getElementById("sidebar").classList.remove("active");
          }
        });
      });

      // Efectos de hover mejorados
      document
        .querySelectorAll(".stat-card, .action-btn, .card")
        .forEach((element) => {
          element.addEventListener("mouseenter", function () {
            this.style.transform = "translateY(-5px)";
          });

          element.addEventListener("mouseleave", function () {
            this.style.transform = "translateY(0)";
          });
        });

      // Función de logout
      function logout() {
        localStorage.removeItem("token");
        localStorage.removeItem("user");
        document.cookie =
          "jwt=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Strict";
        window.location.href = "index.html";
      }

      // Cargar información del usuario
      function loadUserInfo() {
        const userData = localStorage.getItem("user");
        if (userData) {
          const user = JSON.parse(userData);
          $("#userEmail").text(user.mail || "");
          $("#userRole").text(`Nivel: ${user.nivel}`);
        }
      }

      // Inicialización cuando carga la página
      $(document).ready(function () {
        checkAuthOnce();
        updateCurrentDate();
        loadUserInfo();
        simulateRealTimeUpdates();

        $("#logoutBtn").on("click", function (e) {
          e.preventDefault();
          logout();
        });

        // Efecto de notificación
        $(".notification-bell").on("click", function () {
          $(this)
            .find(".notification-badge")
            .fadeOut(300, function () {
              $(this).text("0").fadeIn(300);
            });
        });
      });
    </script>
  </body>
</html>